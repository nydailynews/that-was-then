{% extends "base_raw.html" %}
{% block style %}{% endblock style %}
{% block head %}{% endblock head %}
{% block content %}
<script>
var sb = {
    rando: function()
    {
        // Generate a random ascii string, useful for busting caches.
        var text = "";
        var possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

        for( var i=0; i < 20; i++ )
            text += possible.charAt(Math.floor(Math.random() * possible.length));

        return text;
    },
    get_line_data: function(key, value) {
        // loop through the data object until an item's key matches its value.
        var l = this.data.length;
        for ( var i = 0; i < l; i ++ ) {
            if ( this.data[i][key] == value ) return this.data[i];
        }
    },
    parse_url: function() {
        // Take a document.location such as .../amazing-history-nyc/sb.?r=http://www.nydailynews.com/new-york/good-land-fall-henry-hudson-great-river-1.790116
        // and return the r value.
        var u = document.location.search;
        return u.replace('?r=', '').trim();
    },
    init: function() {
        // Loop through the data.
        // Figure out the last alert, also, add some helper attributes to the data.
        //
        // If a line has a value of -1 in its stop field, that means it's a current alert
        // and the timer should be zero and stay at zero.
        this.prev = {};
        this.current = {};
        this.next = {};
        this.match = 0;
        this.referer = this.parse_url();
        Array.prototype.forEach.call(this.data, function(item, i) {
            // If we match the URL we then want the previous and next articles
            // to populate the sb.
            item = sb.data[i];
            if ( sb.match == 1 ) {
                sb.next = item;
                sb.match = 2;
                return false;
            }

            if ( item['URL'] == sb.referer ) {
                sb.match = 1;
                sb.prev = sb.current;
            }
            else {
                sb.current = item;
            }
            
        });
    }
};
$.getJSON('../../static/data/bigtown.json', function(data) {
    sb.data = data;
    sb.init();
});
</script>
{% endblock content %}
